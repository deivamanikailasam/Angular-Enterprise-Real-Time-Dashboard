<div class="relative flex h-screen w-full overflow-hidden bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950">
  <!-- Decorative background elements -->
  <div class="pointer-events-none absolute inset-0">
    <div class="absolute -left-20 top-0 h-96 w-96 rounded-full bg-gradient-to-br from-blue-900/20 to-indigo-900/20 blur-3xl"></div>
    <div class="absolute -right-20 bottom-0 h-96 w-96 rounded-full bg-gradient-to-tl from-violet-900/20 to-purple-900/20 blur-3xl"></div>
    <div class="absolute left-1/2 top-1/3 h-64 w-64 -translate-x-1/2 rounded-full bg-gradient-to-r from-cyan-900/15 to-blue-900/15 blur-3xl"></div>
  </div>

  <aside
    class="relative z-20 flex w-64 flex-shrink-0 flex-col border-r border-slate-800/50 bg-gradient-to-b from-slate-900/95 via-slate-900 to-slate-950/95 shadow-2xl shadow-black/50 backdrop-blur-xl">
    <div class="px-5 pb-4 pt-6">
      <div class="flex items-center gap-2.5 mb-1">
        <div class="flex h-9 w-9 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 via-indigo-500 to-purple-500 shadow-lg shadow-blue-500/40 ring-2 ring-blue-500/30">
          <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
            <path
              d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"
            />
          </svg>
        </div>
        <div>
          <h1 class="text-lg font-bold text-white">Enterprise</h1>
          <p class="text-xs text-blue-400 font-medium">Dashboard</p>
        </div>
      </div>

      <div class="mt-4 space-y-2 rounded-lg border border-slate-700/50 bg-gradient-to-br from-slate-800/50 to-slate-900/50 p-3 shadow-lg backdrop-blur-sm">
        <p class="text-xs uppercase tracking-[0.35em] text-slate-400 font-semibold">Quick Stats</p>
        <div class="space-y-2.5">
          <div class="flex items-center justify-between text-xs">
            <span class="text-slate-400">Total Metrics</span>
            <span class="font-bold text-white">{{ dashboardHealth().total }}</span>
          </div>
          <div class="flex items-center justify-between text-xs">
            <span class="text-slate-400">Healthy</span>
            <span class="font-bold text-emerald-400">{{ dashboardHealth().healthy }}</span>
          </div>
          <div class="flex items-center justify-between text-xs">
            <span class="text-slate-400">Critical</span>
            <span class="font-bold text-rose-400">{{ dashboardHealth().critical }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="px-5 pb-2 pt-2 text-xs uppercase tracking-[0.35em] text-slate-400 font-semibold">Navigation</div>

    <nav class="flex-1 overflow-y-auto px-3 pb-4">
      <div class="space-y-2">
        @if (authGuard.hasAdminRole()) {
          <a
            routerLink="/admin/metrics"
            routerLinkActive="active-link"
            class="nav-link"
            [routerLinkActiveOptions]="{ exact: true }"
          >
            <span class="nav-indicator" aria-hidden="true"></span>
            <span class="nav-icon">
              <mat-icon>settings</mat-icon>
            </span>
            <span class="nav-label">Metrics Management</span>
            <mat-icon class="nav-caret" aria-hidden="true">chevron_right</mat-icon>
          </a>
        }

        @if (authGuard.canEditDashboard()) {
          <a
            routerLink="/dashboard/customize"
            routerLinkActive="active-link"
            class="nav-link"
          >
            <span class="nav-indicator" aria-hidden="true"></span>
            <span class="nav-icon nav-icon--accent">
              <mat-icon>tune</mat-icon>
            </span>
            <span class="nav-label">Customize Layout</span>
            <mat-icon class="nav-caret" aria-hidden="true">chevron_right</mat-icon>
          </a>
        }

        <a
          routerLink="/dashboard/view"
          routerLinkActive="active-link"
          class="nav-link"
          [routerLinkActiveOptions]="{ exact: true }"
        >
          <span class="nav-indicator" aria-hidden="true"></span>
          <span class="nav-icon nav-icon--info">
            <mat-icon>dashboard</mat-icon>
          </span>
          <span class="nav-label">View Metrics</span>
          <mat-icon class="nav-caret" aria-hidden="true">chevron_right</mat-icon>
        </a>

        <a
          routerLink="/dashboard/alerts"
          routerLinkActive="active-link"
          class="nav-link"
        >
          <span class="nav-indicator" aria-hidden="true"></span>
          <span class="nav-icon nav-icon--alert">
            <mat-icon>notifications</mat-icon>
          </span>
          <span class="nav-label">Alerts</span>
          <mat-icon class="nav-caret" aria-hidden="true">chevron_right</mat-icon>
        </a>
      </div>
    </nav>

    <div class="relative z-10 mt-auto border-t border-slate-800/50 bg-gradient-to-r from-slate-800/50 to-slate-900/50 px-4 py-3 backdrop-blur">
      <div class="text-xs uppercase tracking-[0.3em] text-slate-400 font-semibold mb-1">Signed in</div>
      <div class="text-xs font-bold text-white truncate">
        {{ authGuard.currentUser$()?.email }}
      </div>
      <div class="mt-0.5 text-xs text-slate-400 truncate">
        Role: {{ authGuard.currentUser$()?.roles?.join(', ') ?? 'N/A' }}
      </div>
    </div>
  </aside>

  <div class="relative z-10 flex min-w-0 flex-1 flex-col overflow-hidden">
    <header class="relative border-b border-slate-800/50 bg-gradient-to-b from-slate-900/90 via-slate-900/95 to-slate-950/95 backdrop-blur-xl shadow-lg flex-shrink-0">
      <div class="flex w-full flex-col gap-4 px-4 py-4 sm:px-6 lg:px-8">
        <div class="flex flex-wrap items-start justify-between gap-4">
          <div class="flex min-w-0 flex-1 flex-col gap-2">
            <div class="text-xs uppercase tracking-[0.35em] text-blue-400 font-bold">Active Tenant</div>
            <div class="flex flex-wrap items-center gap-2.5">
              <h2 class="text-xl font-bold text-white truncate">
                {{ tenantService.tenantName() }}
              </h2>

              @if (authGuard.hasAdminRole()) {
                <button
                  [matMenuTriggerFor]="tenantMenu"
                  class="group flex items-center gap-2.5 rounded-lg border border-slate-700 bg-slate-800/50 px-3 py-1.5 text-sm font-medium text-slate-200 shadow-lg transition hover:border-slate-600 hover:bg-slate-800 focus-visible:ring-2 focus-visible:ring-blue-500/30"
                >
                  <span class="whitespace-nowrap text-xs leading-normal">{{ tenantService.tenantName() }}</span>
                  <mat-icon class="text-base text-blue-400 transition group-hover:text-blue-300 shrink-0 flex items-center justify-center w-4 h-4">expand_more</mat-icon>
                </button>

                <mat-menu #tenantMenu="matMenu" class="tenant-menu">
                  @for (tenant of tenantService.availableTenants$(); track tenant.id) {
                    <button 
                      mat-menu-item 
                      (click)="onTenantMenuSelect(tenant.id)"
                      [class.menu-item-selected]="tenant.id === tenantService.activeTenant$()?.id"
                    >
                      <span>{{ tenant.name }}</span>
                    </button>
                  }
                </mat-menu>
              }
            </div>
            <p class="text-xs text-slate-400 leading-relaxed">
              Real-time monitoring of mission-critical metrics across your enterprise footprint.
            </p>
          </div>

          <div class="flex flex-wrap items-center gap-2">
            <button
              class="relative flex h-9 w-9 items-center justify-center rounded-lg border border-slate-700 bg-slate-800/50 text-slate-300 shadow-lg transition hover:border-slate-600 hover:bg-slate-800 hover:text-white focus-visible:ring-2 focus-visible:ring-blue-500/30"
            >
              <mat-icon class="text-lg">notifications</mat-icon>
              @if (criticalMetricsCount() > 0) {
                <span
                  class="absolute -top-1 -right-1 inline-flex h-4 min-w-[1rem] items-center justify-center rounded-full bg-rose-500 px-1 text-[0.65rem] font-semibold text-white shadow-lg shadow-rose-500/50 ring-2 ring-slate-900"
                >
                  {{ criticalMetricsCount() }}
                </span>
              }
            </button>

            <button
              [matMenuTriggerFor]="userMenu"
              class="group flex items-center gap-2.5 rounded-lg border border-slate-700 bg-slate-800/50 px-3 py-1.5 text-sm font-medium text-slate-200 shadow-lg transition hover:border-slate-600 hover:bg-slate-800 focus-visible:ring-2 focus-visible:ring-blue-500/30"
            >
              <span
                class="user-icon-wrapper flex h-7 w-7 shrink-0 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 via-indigo-500 to-purple-500 text-white shadow-lg shadow-blue-500/40 transition group-hover:shadow-xl group-hover:shadow-blue-500/50"
              >
                <mat-icon class="text-base !leading-none !m-0 flex items-center justify-center">account_circle</mat-icon>
              </span>
              <span class="hidden sm:inline whitespace-nowrap text-xs leading-normal">{{ authGuard.currentUser$()?.email ? authGuard.currentUser$()?.email?.split('@')?.[0] ?? '' : '' }}</span>
              <mat-icon class="text-base text-blue-400 transition group-hover:text-blue-300 shrink-0 flex items-center justify-center w-4 h-4">expand_more</mat-icon>
            </button>

            <mat-menu #userMenu="matMenu" class="user-menu">
              <button mat-menu-item (click)="onProfile()">
                <mat-icon>person</mat-icon>
                <span>Profile</span>
              </button>
              <button mat-menu-item (click)="onSettings()">
                <mat-icon>settings</mat-icon>
                <span>Settings</span>
              </button>
              <mat-divider></mat-divider>
              <button mat-menu-item (click)="onLogout()">
                <mat-icon>logout</mat-icon>
                <span>Logout</span>
              </button>
            </mat-menu>
          </div>
        </div>

        <div class="grid gap-2.5 rounded-lg border border-slate-800/50 bg-gradient-to-br from-slate-800/50 via-slate-900/50 to-slate-950/50 p-3 shadow-xl shadow-black/50 sm:grid-cols-2 lg:grid-cols-[2fr,1fr]">
          <div class="grid grid-cols-3 gap-2">
            <div class="rounded-lg border border-slate-700/50 bg-slate-800/50 p-2.5 shadow-lg backdrop-blur-sm">
              <div class="text-xs uppercase tracking-[0.3em] text-slate-400 font-semibold mb-0.5">Total</div>
              <div class="text-lg font-bold text-white">
                {{ dashboardHealth().total }}
              </div>
            </div>
            <div class="rounded-lg border border-emerald-700/50 bg-gradient-to-br from-emerald-900/30 to-green-900/20 p-2.5 shadow-lg backdrop-blur-sm">
              <div class="text-xs uppercase tracking-[0.3em] text-emerald-400 font-semibold mb-0.5">Healthy</div>
              <div
                class="text-lg font-bold"
                [class.text-emerald-400]="dashboardHealth().critical === 0"
                [class.text-emerald-300]="dashboardHealth().critical !== 0"
              >
                {{ dashboardHealth().healthy }}
              </div>
            </div>
            <div class="rounded-lg border border-rose-700/50 bg-gradient-to-br from-rose-900/30 to-red-900/20 p-2.5 shadow-lg backdrop-blur-sm">
              <div class="text-xs uppercase tracking-[0.3em] text-rose-400 font-semibold mb-0.5">Critical</div>
              <div class="text-lg font-bold text-rose-400">
                {{ dashboardHealth().critical }}
              </div>
            </div>
          </div>

          <div class="flex flex-col justify-center rounded-lg border border-blue-700/50 bg-gradient-to-br from-blue-900/30 to-indigo-900/30 p-3 text-right shadow-lg shadow-blue-900/20 backdrop-blur-sm">
            <div class="text-xs uppercase tracking-[0.3em] text-blue-400 font-bold mb-1">System Health</div>
            <div class="text-2xl font-bold bg-gradient-to-r from-blue-400 via-indigo-400 to-purple-400 bg-clip-text text-transparent mb-1">
              {{ dashboardHealth().healthPercentage | number: '1.0-0' }}%
            </div>
            <p class="text-xs text-slate-400 leading-relaxed">
              Real-time signal stability monitoring
            </p>
          </div>
        </div>
      </div>
    </header>

    <main class="relative flex-1 overflow-auto bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950">
      <div class="relative w-full h-full px-4 py-4 sm:px-6 lg:px-8">
        <router-outlet></router-outlet>
      </div>
    </main>
  </div>
</div>
